{% extends 'accounts/base.html' %}

{% block title %}SPIST - My Assessments{% endblock %}

{% block content %}
<div class="card">
    <div style="display: flex; justify-content: space-between; align-items: center;">
        <div>
            <h2>My Assessments</h2>
            <p>Manage your quizzes and exams</p>
        </div>
        <a href="{% url 'assessments:assessment_selection' %}" class="btn">+ Create New Assessment</a>
    </div>
</div>

{% if assessments %}
    <div style="display: grid; gap: 1rem;">
        {% for assessment in assessments %}
        <div class="card" style="padding: 1.5rem;">
            <div style="display: flex; justify-content: space-between; align-items: start;">
                <div style="flex: 1;">
                    <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 0.5rem;">
                        <h3 style="margin: 0;">{{ assessment.title }}</h3>
                        <span style="padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 12px; font-weight: bold; text-transform: uppercase;
                                     {% if assessment.status == 'published' %}background-color: #e8f5e8; color: #2e7d32;
                                     {% elif assessment.status == 'draft' %}background-color: #fff3e0; color: #f57c00;
                                     {% else %}background-color: #f5f5f5; color: #666;{% endif %}">
                            {{ assessment.get_status_display }}
                        </span>
                        <span style="padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 12px; font-weight: bold; text-transform: uppercase;
                                     background-color: #e3f2fd; color: #1976d2;">
                            {{ assessment.get_assessment_type_display }}
                        </span>
                    </div>
                    
                    {% if assessment.description %}
                    <p style="color: #666; margin-bottom: 1rem;">{{ assessment.description|truncatechars:150 }}</p>
                    {% endif %}
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 1rem; font-size: 14px; color: #666;">
                        <div>
                            <strong>Questions:</strong> {{ assessment.questions.count }}
                        </div>
                        <div>
                            <strong>Created:</strong> {{ assessment.created_at|date:"M d, Y" }}
                        </div>
                        {% if assessment.time_limit %}
                        <div>
                            <strong>Time Limit:</strong> {{ assessment.time_limit }} min
                        </div>
                        {% endif %}
                        <div>
                            <strong>Max Attempts:</strong> {{ assessment.max_attempts }}
                        </div>
                        <div>
                            <strong>Passing Score:</strong> {{ assessment.passing_score }}%
                        </div>
                        {% if assessment.available_from %}
                        <div>
                            <strong>Available:</strong> {{ assessment.available_from|date:"M d, Y H:i" }}
                        </div>
                        {% endif %}
                    </div>
                </div>
                
                <div style="display: flex; flex-direction: column; gap: 0.5rem; margin-left: 2rem;">
                    <a href="{% url 'assessments:assessment_detail' assessment.id %}" class="btn" style="font-size: 14px; padding: 0.5rem 1rem;">View</a>
                    <a href="{% url 'assessments:edit_assessment' assessment.id %}" class="btn" style="font-size: 14px; padding: 0.5rem 1rem; background-color: #666;">Edit</a>
                    
                    {% if assessment.status == 'draft' %}
                        {% if assessment.questions.count > 0 %}
                        <form method="post" action="{% url 'assessments:publish_assessment' assessment.id %}" style="margin: 0;">
                            {% csrf_token %}
                            <button type="submit" class="btn" style="font-size: 14px; padding: 0.5rem 1rem; background-color: #2e7d32; width: 100%;">Publish</button>
                        </form>
                        {% else %}
                        <span style="font-size: 14px; padding: 0.5rem 1rem; background-color: #f5f5f5; color: #666; text-align: center; border-radius: 4px;">Add Questions First</span>
                        {% endif %}
                    {% endif %}
                    
                    <a href="{% url 'assessments:add_question' assessment.id %}" class="btn" style="font-size: 14px; padding: 0.5rem 1rem; background-color: #4caf50;">Add Questions</a>
                    
                    <form method="post" action="{% url 'assessments:delete_assessment' assessment.id %}" 
                          style="margin: 0;" 
                          onsubmit="return confirm('Are you sure you want to delete this assessment? This action cannot be undone.')">
                        {% csrf_token %}
                        <button type="submit" class="btn" style="font-size: 14px; padding: 0.5rem 1rem; background-color: #d32f2f; width: 100%;">Delete</button>
                    </form>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
    
    <!-- Pagination would go here if needed -->
    
{% else %}
    <div class="card" style="text-align: center; padding: 3rem;">
        <h3 style="color: #666; margin-bottom: 1rem;">No Assessments Yet</h3>
        <p style="color: #888; margin-bottom: 2rem;">You haven't created any quizzes or exams yet. Get started by creating your first assessment!</p>
        <a href="{% url 'assessments:assessment_selection' %}" class="btn">Create Your First Assessment</a>
    </div>
{% endif %}
{% endblock %}
